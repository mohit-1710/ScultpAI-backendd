# Google Cloud Storage Implementation for SculptAI

This document describes how video and audio files are stored using Google Cloud Storage in the SculptAI application.

## Overview

Videos and audio files generated by the SculptAI application are now stored in Google Cloud Storage (GCS) instead of locally. This allows for:

- Improved scalability
- Accessibility from anywhere
- Reduced server storage requirements
- Better reliability and redundancy

## Configuration

### Backend Configuration

Add the following to your `.env` file:

```
# === Google Cloud Storage Configuration ===
GCS_PROJECT_ID=your-gcs-project-id
GCS_BUCKET_NAME=sculptai-media
GCS_KEY_FILE=/path/to/your-service-account-key.json
GCS_BASE_URL=https://storage.googleapis.com/sculptai-media
```

### Manim Renderer Configuration

Add the following to the manim-renderer's `.env` file:

```
# === Google Cloud Storage Settings ===
USE_CLOUD_STORAGE=true
GCS_PROJECT_ID=your-gcs-project-id
GCS_BUCKET_NAME=sculptai-media
GCS_KEY_FILE=/path/to/your-service-account-key.json
GCS_BASE_URL=https://storage.googleapis.com/sculptai-media
```

## Implementation Details

### Storage Service

The backend now includes a `storageService.js` module that handles uploading files to Google Cloud Storage. The main functions are:

- `uploadVideo(localFilePath, sceneId)`: Uploads a video file to GCS and returns its public URL
- `uploadAudio(localFilePath, sceneId)`: Uploads an audio file to GCS and returns its public URL
- `deleteFile(fileUrl)`: Deletes a file from GCS

### Manim Service

The Manim service has been updated to:

1. Upload rendered videos to Google Cloud Storage
2. Return Cloud Storage URLs instead of local file paths
3. Handle both cloud and local file paths for backward compatibility

### TTS Service

The TTS service has been updated to:

1. Upload generated audio files to Google Cloud Storage
2. Return Cloud Storage URLs instead of local file paths

### Frontend

The frontend now expects direct URLs to videos and audio files instead of local file paths. The URL formatting functions have been updated to handle Cloud Storage URLs.

## Setting up Google Cloud Storage

1. Create a GCS bucket named `sculptai-media` (or choose your own name)
2. Set the bucket's access to "Public" or configure appropriate permissions
3. Create a service account key with Storage Admin permissions
4. Download the service account key as a JSON file
5. Set the path to this file in your `.env` file as `GCS_KEY_FILE`

## File Structure

Files in Google Cloud Storage are organized as follows:

- `/videos/`: Contains all rendered video files
- `/audio/`: Contains all generated audio files

Files are named using the pattern: `{sceneId}-{hash}.{extension}`

## Fallback Mechanism

If uploading to Google Cloud Storage fails for any reason, the application will fall back to storing files locally to ensure the application continues to function. 